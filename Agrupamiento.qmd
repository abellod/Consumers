# Agrupamiento geografico

Dados los objetivos de este proyecto, se caracteriza a los departamentos de acuerdo a su puntaje, estos son clasificados en 5 grupos pensando en que departamentos que pertenecen a la misma región geográfica pueden tener resultados similares en el puntaje global.

```{r}
#| echo: false
#| results: hide
#| message: false
#| warning: false

library(FactoClass)
library(Factoshiny)
library(factoextra)
library(plotly)
library(knitr)
library(DT)
library(GDAtools)
library(readr)
library(dplyr)

# 4 cifras significativas y sin notación científica:
options(digits = 4, scipen = 999) 

#setwd("C:\\Users\\soffy\\OneDrive\\Escritorio\\Universidad\\Multivariada\\Consumers")

# Carga de datos originales
saberpro <- read_delim("DATA_ICFES_SABERPROPROFESIONAL_2022-2.TXT", delim = "¬", escape_double = FALSE, trim_ws = TRUE)
kable(head(saberpro), digits=2) 

# nuestros datos
data <- saberpro[,-c(1,2,5:9,13:15,17:21,23:26,28:34,49:54,56:62,65,67:70,72:75,77:82,84:86,88:90,92:94,96:98,100:102,104:109)]

# genero
sum(is.na(data$ESTU_GENERO)) # hay 5 NA'S
data$ESTU_GENERO <- ifelse(is.na(data$ESTU_GENERO), "Desconocido", data$ESTU_GENERO)
data$ESTU_GENERO <- as.factor(data$ESTU_GENERO)
table(data$ESTU_GENERO)

# edad
# esta la quitamos
library(stringr)
edad <- str_sub(data$ESTU_FECHANACIMIENTO,7,10)
edad<-as.numeric(edad)
edades<-2023-edad
summary(edades)

# etnia
sum(is.na(data$ESTU_TIENEETNIA)) # 775 na's
data$ESTU_TIENEETNIA <- ifelse(is.na(data$ESTU_TIENEETNIA), "Desconocido", data$ESTU_TIENEETNIA)
data$ESTU_TIENEETNIA <- as.factor(data$ESTU_TIENEETNIA)
table(data$ESTU_TIENEETNIA)

# depto
data$ESTU_DEPTO_RESIDE<-ifelse(data$ESTU_DEPTO_RESIDE %in% c("BARCELONA","BUENOS AIRES","FRANKFURT","HOUSTON","LIMA","MIAMI","NUEVA YORK","PARIS","QUEBEC","ROMA","SACRAMENTO","SANTIAGO DE CHILE","SAO PAULO","SEUL","TRENTON"),"EXTRANJERO",data$ESTU_DEPTO_RESIDE)
sum(is.na(data$ESTU_DEPTO_RESIDE))
length(unique(data$ESTU_DEPTO_RESIDE)) # hay 35 pq son mas los extranjeros y NAs
data$ESTU_DEPTO_RESIDE <- ifelse(is.na(data$ESTU_DEPTO_RESIDE), "Desconocido", data$ESTU_DEPTO_RESIDE)
data$ESTU_DEPTO_RESIDE <- ifelse(data$ESTU_DEPTO_RESIDE== "Desconocido", "BOGOTÁ", data$ESTU_DEPTO_RESIDE)
data$ESTU_DEPTO_RESIDE <- as.factor(data$ESTU_DEPTO_RESIDE)
#data <- data %>%
  # mutate(ESTU_DEPTO_RESIDE = case_when(
  #   ESTU_DEPTO_RESIDE == "BOGOTÁ" ~ ESTU_DEPTO_RESIDE,
  #   ESTU_DEPTO_RESIDE == "Desconocido" ~ "Desconocido",
  #   TRUE ~ "OTRO"
  # ))
data$ESTU_DEPTO_RESIDE <- as.factor(data$ESTU_DEPTO_RESIDE)
table(data$ESTU_DEPTO_RESIDE)


# estado civil
sum(is.na(data$ESTU_ESTADOCIVIL)) # 580 na's
data$ESTU_ESTADOCIVIL <- ifelse(is.na(data$ESTU_ESTADOCIVIL), "Desconocido", ifelse(data$ESTU_ESTADOCIVIL=="Casado","C",ifelse(data$ESTU_ESTADOCIVIL=="Separado y/o Viudo","SyoV",ifelse(data$ESTU_ESTADOCIVIL=="Soltero","S","UL"))))
data$ESTU_ESTADOCIVIL <- as.factor(data$ESTU_ESTADOCIVIL)
table(data$ESTU_ESTADOCIVIL)

# valor matricula
## recodificamos para que quede como factor
sum(is.na(data$ESTU_VALORMATRICULAUNIVERSIDAD)) # 2194 na's
data$ESTU_VALORMATRICULAUNIVERSIDAD <- ifelse(is.na(data$ESTU_VALORMATRICULAUNIVERSIDAD), "Desconocido", ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Menos de 500 mil","m500",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Entre 500 mil y menos de 1 millón","e500m1",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Entre 1 millón y menos de 2.5 millones","e1m2.5",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Entre 2.5 millones y menos de 4 millones","e2.5m4",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Entre 4 millones y menos de 5.5 millones","e4m5.5",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Entre 5.5 millones y menos de 7 millones","e5.5m7",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Más de 7 millones","M7","NP"))))))))
data$ESTU_VALORMATRICULAUNIVERSIDAD <- factor(data$ESTU_VALORMATRICULAUNIVERSIDAD, levels = c("m500","e500m1", "e1m2.5", "e2.5m4","e4m5.5","e5.5m7","M7","NP","Desconocido"))
table(data$ESTU_VALORMATRICULAUNIVERSIDAD)

# capacitacion del examen
sum(is.na(data$ESTU_COMOCAPACITOEXAMENSB11)) # 2069 na's
data$ESTU_COMOCAPACITOEXAMENSB11 <- ifelse(is.na(data$ESTU_COMOCAPACITOEXAMENSB11), "Desconocido", ifelse(data$ESTU_COMOCAPACITOEXAMENSB11=="No realizó ninguna prueba de preparación","Ninguna",ifelse(data$ESTU_COMOCAPACITOEXAMENSB11=="Repasó por cuenta propia","CuentaPropia","Curso")))
data$ESTU_COMOCAPACITOEXAMENSB11 <- as.factor(data$ESTU_COMOCAPACITOEXAMENSB11)
table(data$ESTU_COMOCAPACITOEXAMENSB11)


# semestre que cursa
sum(is.na(data$ESTU_SEMESTRECURSA)) # 2194 na's
data$ESTU_SEMESTRECURSA<-ifelse(data$ESTU_SEMESTRECURSA %in% c("01","02","03","04","05","06"),"06m",ifelse(data$ESTU_SEMESTRECURSA=="12 o más","12M",data$ESTU_SEMESTRECURSA))
data$ESTU_SEMESTRECURSA <- ifelse(is.na(data$ESTU_SEMESTRECURSA), "Desconocido", data$ESTU_SEMESTRECURSA)
data$ESTU_SEMESTRECURSA <- as.factor(data$ESTU_SEMESTRECURSA)
table(data$ESTU_SEMESTRECURSA)

# educacion papa
sum(is.na(data$FAMI_EDUCACIONPADRE)) # 4738 na's
data$FAMI_EDUCACIONPADRE <- ifelse(is.na(data$FAMI_EDUCACIONPADRE), "Desconocido", ifelse(data$FAMI_EDUCACIONPADRE=="Educación profesional completa","EPC",ifelse(data$FAMI_EDUCACIONPADRE=="Educación profesional incompleta","EPI",ifelse(data$FAMI_EDUCACIONPADRE=="No Aplica","NAp",ifelse(data$FAMI_EDUCACIONPADRE=="No sabe","NS",ifelse(data$FAMI_EDUCACIONPADRE=="Postgrado","Post",ifelse(data$FAMI_EDUCACIONPADRE=="Primaria completa","PC",ifelse(data$FAMI_EDUCACIONPADRE=="Primaria incompleta","PI",ifelse(data$FAMI_EDUCACIONPADRE=="Secundaria (Bachillerato) completa","BC",ifelse(data$FAMI_EDUCACIONPADRE=="Secundaria (Bachillerato) incompleta","BI",ifelse(data$FAMI_EDUCACIONPADRE=="Técnica o tecnológica completa","TTC",ifelse(data$FAMI_EDUCACIONPADRE=="Técnica o tecnológica incompleta","TTI",data$FAMI_EDUCACIONPADRE))))))))))))
data$FAMI_EDUCACIONPADRE <- as.factor(data$FAMI_EDUCACIONPADRE)
table(data$FAMI_EDUCACIONPADRE)

# educacion mama
sum(is.na(data$FAMI_EDUCACIONMADRE)) # 4886 na's
data$FAMI_EDUCACIONMADRE <- ifelse(is.na(data$FAMI_EDUCACIONMADRE), "Desconocido", ifelse(data$FAMI_EDUCACIONMADRE=="Educación profesional completa","EPC",ifelse(data$FAMI_EDUCACIONMADRE=="Educación profesional incompleta","EPI",ifelse(data$FAMI_EDUCACIONMADRE=="No Aplica","NAp",ifelse(data$FAMI_EDUCACIONMADRE=="No sabe","NS",ifelse(data$FAMI_EDUCACIONMADRE=="Postgrado","Post",ifelse(data$FAMI_EDUCACIONMADRE=="Primaria completa","PC",ifelse(data$FAMI_EDUCACIONMADRE=="Primaria incompleta","PI",ifelse(data$FAMI_EDUCACIONMADRE=="Secundaria (Bachillerato) completa","BC",ifelse(data$FAMI_EDUCACIONMADRE=="Secundaria (Bachillerato) incompleta","BI",ifelse(data$FAMI_EDUCACIONMADRE=="Técnica o tecnológica completa","TTC",ifelse(data$FAMI_EDUCACIONMADRE=="Técnica o tecnológica incompleta","TTI",data$FAMI_EDUCACIONMADRE))))))))))))
data$FAMI_EDUCACIONMADRE <- as.factor(data$FAMI_EDUCACIONMADRE)
table(data$FAMI_EDUCACIONMADRE)

# ocupacion papa
sum(is.na(data$FAMI_OCUPACIONPADRE)) # 2060 na's
data$FAMI_OCUPACIONPADRE <- ifelse(is.na(data$FAMI_OCUPACIONPADRE), "Desconocido", ifelse(data$FAMI_OCUPACIONPADRE=="Empleado con cargo como director o gerente general","EDGG",ifelse(data$FAMI_OCUPACIONPADRE=="Empleado de nivel auxiliar o administrativo","ENAA",ifelse(data$FAMI_OCUPACIONPADRE=="Empleado de nivel directivo","END",ifelse(data$FAMI_OCUPACIONPADRE=="Empleado de nivel técnico o profesional","ENTP",ifelse(data$FAMI_OCUPACIONPADRE=="Empleado obrero u operario","EOO",ifelse(data$FAMI_OCUPACIONPADRE=="Empresario","Emp",ifelse(data$FAMI_OCUPACIONPADRE=="Hogar","H",ifelse(data$FAMI_OCUPACIONPADRE=="Otra actividad u ocupación","OAO", ifelse(data$FAMI_OCUPACIONPADRE=="Pensionado","Pen",ifelse(data$FAMI_OCUPACIONPADRE=="Pequeño empresario","PE",ifelse(data$FAMI_OCUPACIONPADRE=="Profesional independiente","PI","TCP"))))))))))))
data$FAMI_OCUPACIONPADRE <- as.factor(data$FAMI_OCUPACIONPADRE)
table(data$FAMI_OCUPACIONPADRE)

# ocupacion mama
sum(is.na(data$FAMI_OCUPACIONMADRE)) # 2060 na's
data$FAMI_OCUPACIONMADRE <- ifelse(is.na(data$FAMI_OCUPACIONMADRE), "Desconocido", ifelse(data$FAMI_OCUPACIONMADRE=="Empleado con cargo como director o gerente general","EDGG",ifelse(data$FAMI_OCUPACIONMADRE=="Empleado de nivel auxiliar o administrativo","ENAA",ifelse(data$FAMI_OCUPACIONMADRE=="Empleado de nivel directivo","END",ifelse(data$FAMI_OCUPACIONMADRE=="Empleado de nivel técnico o profesional","ENTP",ifelse(data$FAMI_OCUPACIONMADRE=="Empleado obrero u operario","EOO",ifelse(data$FAMI_OCUPACIONMADRE=="Empresario","Emp",ifelse(data$FAMI_OCUPACIONMADRE=="Hogar","H",ifelse(data$FAMI_OCUPACIONMADRE=="Otra actividad u ocupación","OAO", ifelse(data$FAMI_OCUPACIONMADRE=="Pensionado","Pen",ifelse(data$FAMI_OCUPACIONMADRE=="Pequeño empresario","PE",ifelse(data$FAMI_OCUPACIONMADRE=="Profesional Independiente","PI","TCP"))))))))))))
data$FAMI_OCUPACIONMADRE <- as.factor(data$FAMI_OCUPACIONMADRE)
table(data$FAMI_OCUPACIONMADRE)

# estrato
sum(is.na(data$FAMI_ESTRATOVIVIENDA)) # 5531 na's
data$FAMI_ESTRATOVIVIENDA <- ifelse(is.na(data$FAMI_ESTRATOVIVIENDA), "Desconocido", data$FAMI_ESTRATOVIVIENDA)
data$FAMI_ESTRATOVIVIENDA <- as.factor(data$FAMI_ESTRATOVIVIENDA)
table(data$FAMI_ESTRATOVIVIENDA)


# internet
sum(is.na(data$FAMI_TIENEINTERNET)) # 5697 na's
data$FAMI_TIENEINTERNET <- ifelse(is.na(data$FAMI_TIENEINTERNET), "Desconocido", data$FAMI_TIENEINTERNET)
data$FAMI_TIENEINTERNET <- as.factor(data$FAMI_TIENEINTERNET)
table(data$FAMI_TIENEINTERNET)

# computador
sum(is.na(data$FAMI_TIENECOMPUTADOR)) # 6163 na's
data$FAMI_TIENECOMPUTADOR <- ifelse(is.na(data$FAMI_TIENECOMPUTADOR), "Desconocido", data$FAMI_TIENECOMPUTADOR)
data$FAMI_TIENECOMPUTADOR <- as.factor(data$FAMI_TIENECOMPUTADOR)
table(data$FAMI_TIENECOMPUTADOR)

# lavadora
sum(is.na(data$FAMI_TIENELAVADORA)) # 6354 na's
data$FAMI_TIENELAVADORA <- ifelse(is.na(data$FAMI_TIENELAVADORA), "Desconocido", data$FAMI_TIENELAVADORA)
data$FAMI_TIENELAVADORA <- as.factor(data$FAMI_TIENELAVADORA)
table(data$FAMI_TIENELAVADORA)

# microogas
sum(is.na(data$FAMI_TIENEHORNOMICROOGAS)) # 7019 na's
data$FAMI_TIENEHORNOMICROOGAS <- ifelse(is.na(data$FAMI_TIENEHORNOMICROOGAS), "Desconocido", data$FAMI_TIENEHORNOMICROOGAS)
data$FAMI_TIENEHORNOMICROOGAS <- as.factor(data$FAMI_TIENEHORNOMICROOGAS)
table(data$FAMI_TIENEHORNOMICROOGAS)

# tv
sum(is.na(data$FAMI_TIENESERVICIOTV)) # 5801 na's
data$FAMI_TIENESERVICIOTV <- ifelse(is.na(data$FAMI_TIENESERVICIOTV), "Desconocido", data$FAMI_TIENESERVICIOTV)
data$FAMI_TIENESERVICIOTV <- as.factor(data$FAMI_TIENESERVICIOTV)
table(data$FAMI_TIENESERVICIOTV)

# auto
sum(is.na(data$FAMI_TIENEAUTOMOVIL)) # 7187 na's
data$FAMI_TIENEAUTOMOVIL <- ifelse(is.na(data$FAMI_TIENEAUTOMOVIL), "Desconocido", data$FAMI_TIENEAUTOMOVIL)
data$FAMI_TIENEAUTOMOVIL <- as.factor(data$FAMI_TIENEAUTOMOVIL)
table(data$FAMI_TIENEAUTOMOVIL)

# moto
sum(is.na(data$FAMI_TIENEMOTOCICLETA)) # 7525 na's
data$FAMI_TIENEMOTOCICLETA <- ifelse(is.na(data$FAMI_TIENEMOTOCICLETA), "Desconocido", data$FAMI_TIENEMOTOCICLETA)
data$FAMI_TIENEMOTOCICLETA <- as.factor(data$FAMI_TIENEMOTOCICLETA)
table(data$FAMI_TIENEMOTOCICLETA)

# consola
sum(is.na(data$FAMI_TIENECONSOLAVIDEOJUEGOS)) # 7993 na's
data$FAMI_TIENECONSOLAVIDEOJUEGOS <- ifelse(is.na(data$FAMI_TIENECONSOLAVIDEOJUEGOS), "Desconocido", data$FAMI_TIENECONSOLAVIDEOJUEGOS)
data$FAMI_TIENECONSOLAVIDEOJUEGOS <- as.factor(data$FAMI_TIENECONSOLAVIDEOJUEGOS)
table(data$FAMI_TIENECONSOLAVIDEOJUEGOS)

# horas trabaja
sum(is.na(data$ESTU_HORASSEMANATRABAJA)) # 6867 na's
data$ESTU_HORASSEMANATRABAJA <- ifelse(is.na(data$ESTU_HORASSEMANATRABAJA), "Desconocido", data$ESTU_HORASSEMANATRABAJA)
data$ESTU_HORASSEMANATRABAJA <- factor(data$ESTU_HORASSEMANATRABAJA, levels = c("0", "Menos de 10 horas", "Entre 11 y 20 horas", "Entre 21 y 30 horas", "Más de 30 horas", "Desconocido"))
table(data$ESTU_HORASSEMANATRABAJA)

# grupo de referencia
sum(is.na(data$GRUPOREFERENCIA)) # 0 na's
data$GRUPOREFERENCIA<-ifelse(data$GRUPOREFERENCIA=="ADMINISTRACIÓN Y AFINES","AdmYAfin",ifelse(data$GRUPOREFERENCIA=="ARQUITECTURA Y URBANISMO","ArqYUrb",ifelse(data$GRUPOREFERENCIA=="BELLAS ARTES Y DISEÑO","BelArtYDis",ifelse(data$GRUPOREFERENCIA=="CIENCIAS AGROPECUARIAS","CienAgr",ifelse(data$GRUPOREFERENCIA=="CIENCIAS MILITARES Y NAVALES","CienMilYNav",ifelse(data$GRUPOREFERENCIA=="CIENCIAS NATURALES Y EXACTAS","CienNatYExac",ifelse(data$GRUPOREFERENCIA=="CIENCIAS SOCIALES","CienSoc",ifelse(data$GRUPOREFERENCIA=="COMUNICACIÓN, PERIODISMO Y PUBLICIDAD","ComuPerYPub",ifelse(data$GRUPOREFERENCIA=="CONTADURÍA Y AFINES","ContYAfin",ifelse(data$GRUPOREFERENCIA=="DERECHO","Derecho",ifelse(data$GRUPOREFERENCIA=="ECONOMÍA","Economía",ifelse(data$GRUPOREFERENCIA=="ECONOMÍA, ADMINISTRACIÓN, CONTADURÍA Y AFINES - UNIVERSITARIA","EcAdContYAfinU",ifelse(data$GRUPOREFERENCIA=="EDUCACIÓN","Educación",ifelse(data$GRUPOREFERENCIA=="ENFERMERÍA","Enfermeria",ifelse(data$GRUPOREFERENCIA=="GRUPO REFERENCIA NACIONAL","GrupRefNal", ifelse(data$GRUPOREFERENCIA=="GRUPO REFERENCIA NACIONAL UNIVERSITARIO","GrupRefNalU", ifelse(data$GRUPOREFERENCIA=="HUMANIDADES","Hum", ifelse(data$GRUPOREFERENCIA=="INGENIERÍA","Inge", ifelse(data$GRUPOREFERENCIA=="MEDICINA","Med", ifelse(data$GRUPOREFERENCIA=="PSICOLOGÍA","Psic", ifelse(data$GRUPOREFERENCIA=="RECREACIÓN Y DEPORTES","RecYDep", "salud")))))))))))))))))))))
data$GRUPOREFERENCIA<- as.factor(data$GRUPOREFERENCIA)
table(data$GRUPOREFERENCIA)
str(data$GRUPOREFERENCIA) # 22 niveles

# metodo
sum(is.na(data$ESTU_METODO_PRGM)) # 0 na's
data$ESTU_METODO_PRGM <- ifelse(data$ESTU_METODO_PRGM == "DISTANCIA VITUAL", "distVirtual", ifelse(data$ESTU_METODO_PRGM=="DISTANCIA","distancia","presencial"))
data$ESTU_METODO_PRGM<- as.factor(data$ESTU_METODO_PRGM)
table(data$ESTU_METODO_PRGM)

# caracter academico institucion
sum(is.na(data$INST_CARACTER_ACADEMICO)) # 0 na's
data$INST_CARACTER_ACADEMICO<-ifelse(data$INST_CARACTER_ACADEMICO=="INSTITUCIÓN TECNOLÓGICA","InstTec",ifelse(data$INST_CARACTER_ACADEMICO=="INSTITUCIÓN UNIVERSITARIA","InstUni", ifelse(data$INST_CARACTER_ACADEMICO=="TÉCNICA PROFESIONAL","TecProf", "Universidad")))
data$INST_CARACTER_ACADEMICO<- as.factor(data$INST_CARACTER_ACADEMICO)
table(data$INST_CARACTER_ACADEMICO)

names(data)[29:33]<-c("cuanti","lec","ciu","ing","esc")
```

Para realizar la clasificación, se utiliza una estrategia completa de agrupamiento, donde se mezclan diferentes técnicas multivariadas. Inicialmente se realiza un *Análisis de Correspondecias Simples, ACS* entre las variables Departamento de residencia del estudiante (*ESTU_DEPTO_RESIDE*) y el puntaje global recodificado en 10 categorías utilizando los percentiles (*globalCAT*)

```{r}
#| echo: false
# # Recodificación puntaje global
# percentiles <- quantile(data$PUNT_GLOBAL, probs = c(0.2, 0.4, 0.6, 0.8))
# 
# data$globalCAT <- cut(data$PUNT_GLOBAL,
#                     breaks = c(-Inf, percentiles[1], percentiles[2], percentiles[3], percentiles[4], Inf),
#                     labels = c("Bajo", "Medio Bajo", "Medio", "Medio Alto", "Alto"))
# reco <- as.data.frame(table(data$globalCAT))
# colnames(reco)<-c("globalCAT","Frecuencia")
# kable(reco)

# Recodificación puntaje global
percentiles <- quantile(data$PUNT_GLOBAL, probs = c(0.1, 0.2, 0.3, 0.4, 0.5,  0.6, 0.7, 0.8, 0.9))

data$globalCAT <- cut(data$PUNT_GLOBAL,
                    breaks = c(0, percentiles[1], percentiles[2], percentiles[3], percentiles[4], percentiles[5], percentiles[6], percentiles[7], percentiles[8], percentiles[9], 300)#,
                    #labels = c("Bajo", "Medio Bajo", "Medio", "Medio Alto", "Alto")
                    )
reco <- as.data.frame(table(data$globalCAT))
colnames(reco)<-c("globalCAT","Frecuencia")
kable(reco)
```

## Procedimiento de agrupación

### Paso 1

Realización del ACS entre las variables `ESTU_DEPTO_RESIDE` y `gobalCAT`

::: callout-note
Para que este ACS no se viera afectado por la poca frecuencia que tiene la categoría "Desconocido" de la variable `ESTU_DEPTO_RESIDE`, se incluyeron los individuos pertenecientes a esta categoría dentro de la categoría `BOGOTÁ`
:::

```{r}
#| echo: false
#| message: false
# Para hacer el data frame que necesita dudi.coa para el acs
K <- unclass(table(data$ESTU_DEPTO_RESIDE, data$globalCAT))
K <- as.data.frame(K)
K <- K[rownames(K) != "EXTRANJERO", ] # Quitamos a los de extranjero


# ACS
set.seed(627) # es necesario fijar la semilla para fijar los valores iniciales del agrupamiento jerarquico
acs <- FactoClass(K, dudi.coa, # funcion acs
                  scanFC=FALSE, # para que no me pregunte en la consola cuantos ejes y cuantos clusters
                  nf=9, # numero de ejes que vamos a dejar
                  nfcl=9, # numero de ejes para usar en la clasificación
                  k.clust=5) # numero de clusters
```

```{r}
#| echo: false
# Inercia de los ejes
barplot(as.vector(acs$dudi$eig), col="darkblue")
```

### Paso 2

Si bien la mayor parte de la inercia se va para un solo eje, para el agrupamiento seleccionamos los 4 ejes ya que no son "demasiados" y pueden servir para clasificar mejor a los individuos (departamentos).

### Paso 3

No fue necesario realizar un K-means de pre-agrupamiento ya que solo se cuenta con 32 individuos (departamentos).

### Paso 4

Los indices de agrupación jerárquica de los departamentos utilizando el método de Wald se muestran a continuación.

```{r}
#| echo: false
barplot(rev(tail(acs$indices$Indice)), horiz=TRUE, col="darkblue")
```

### Paso 5

Como se mencionó previamente, el corte se hizo para 5 grupos, de modo que se obtienen los valores inciales para el K-means.

El dendograma de la agrupación jerárquica es:

```{r}
#| echo: false
sca <- dudi.coa(K, scannf=FALSE, nf=5)
F <- as.matrix(sca$li); n <- nrow(F)
set.seed(627)
hclCafe <- ward.cluster(dista=dist(F), h.clust=1) # función de FactoClass
plot(hclCafe, las=1, col="darkblue", main="", sub="", xlab="")
abline(h=seq(0, 7, 0.5), col="gray90", lty=3)
```

### Paso 6

A continuación, se muestran los cambios en tamaño y en la inercia luego del K-means

```{r}
#| echo: false
kable(acs$clus.summ[, 1:4])
```

En general, ni los tamaños de los grupos ni la inercia dentro-grupo se modificaron demasiado. El agrupamiento jerárquico dio una buena partición incial.

### Paso 7

Caracterización y visualización de los grupos:

::: panel-tabset
#### Grupo 1

En el grupo 1 se tiene:

-   Las categorías "$(113,124]$", "$(0,113]$" y "$(0124,132]$" están sobre-representadas, ya que sus $Test.Values$ son muy grandes en valor absoluto y positivos. El $48.2\%$ de los individuos en esta clase pertenecen a estas categorías, lo cual es **mucho más alto** que su proporción global del $31.1\%$.

-   Para las categorías "$(132,139]$" y "$(139,145]$", en proporción hay más en el grupo que en la proporción global, sin embargo, aunque sus $Test.Values$ son significativos, no son **tan altos** respecto a las categorías mencionadas anteriormente. Lo mismo pasa para la categoría "$(145,152]$" , sólo que para esta categoría la proporción del grupo es menor respecto a la proporción global, con un $Test.Value$ en valor absoluto mayor a dos pero que respecto a otras categorías no es tan notorio.

-   Por último, las categorías "$(152,160]$", "$(160,168]$", "$(168,180]$" y "$(180,300]$" están sub-representadas, ya que sus $Test.Values$ son muy grandes en valor absoluto y negativos. El $20.6\%$ de los individuos en esta clase pertenecen a estas categorías, lo cual es **más bajo** que su proporción global del $39.6\%$.

En general, este grupo contiene a personas que tuvieron un mal desempeño en el examen, sin embargo no es el peor, pues están más representados los individuos con puntajes en el intervalo "$(113,124]$" que en el intervalo "$(0,113]$".

```{r}
#| echo: false
repre <- acs$carac.frec
names(repre) <- c("cl1","cl2","cl3","cl4","cl5")

kable(repre$cl1)
```

Los departamentos que hacen parte del grupo 1 son:

```{r}
#| echo: false
cluster_df <- data.frame(
  Depto = names(acs$cluster),   # deptos
  Cluster = as.numeric(acs$cluster)  # clusters
)

#str(cluster_df)
kable(cluster_df[cluster_df$Cluster==1,])
```

Los mejores ejes para visualizar este grupo son 1 y 3 de acuerdo con `acs$cor.clus`

```{r}
#| echo: false
plotFactoClass(acs, x=1, y=3, cex.col=0.5,
               roweti="", infaxes="no", cstar=0)
```

#### Grupo 2

En el grupo 2 se tiene:

-   Las categorías "$(168,180]$" y "$(160,168]$" están sobre-representadas, ya que sus $Test.Values$ son muy grandes en valor absoluto y positivos, aunque en proporción, esto no se nota tanto, pues el $20.6\%$ de los individuos en esta clase pertenecen a estas categorías, lo cual es **más alto** que su proporción global del $19.1\%$, pero no es tan notorio.

-   Para las categorías "$(180,300]$" y "$(152,160]$", en proporción hay más en el grupo que en la proporción global, sin embargo, aunque sus $Test.Values$ son significativos, no son **tan altos** respecto a las categorías mencionadas anteriormente. Lo mismo pasa para las categorías "$(132,139]$" y "$(124,132]$", sólo que para estas categorías la proporción del grupo es menor respecto a la proporción global, con un $Test.Value$ en valor absoluto mayor a dos pero que respecto a otras categorías no es tan notorio.

-   Por último, las categorías "$(113,124]$" y "$(0,113]$" están sub-representadas, ya que sus $Test.Values$ son muy grandes en valor absoluto y negativos. El $19.3\%$ de los individuos en esta clase pertenecen a estas categorías, lo cual es **más bajo** que su proporción global del $20.9\%$, pero no es tan notorio.

En general, este grupo contiene a personas que tuvieron un buen desempeño en el examen, sin embargo no es el mejor, pues están más representados los individuos con puntajes en los intervalos "$(168,180]$" y "$(160,168]$" que en el intervalo "$(180,300]$".

```{r}
#| echo: false
kable(repre$cl2)
```

Los departamentos que hacen parte del grupo 2 son:

```{r}
#| echo: false

#str(cluster_df)
kable(cluster_df[cluster_df$Cluster==2,])
```

Los mejores ejes para visualizar este grupo son 1 y 3 de acuerdo con `acs$cor.clus`

```{r}
#| echo: false
plotFactoClass(acs, x=1, y=3, cex.col=0.5,
               roweti="", infaxes="no", cstar=0)
```

#### Grupo 3

En el grupo 3 se tiene:

-   Las categorías "$(180,300]$", "$(168,180]$" y "$(160,168]$" están sobre-representadas, ya que sus $Test.Values$ son muy grandes en valor absoluto y positivos, pues el $39.6\%$ de los individuos en esta clase pertenecen a estas categorías, lo cual es **más alto** que su proporción global del $28.9\%$.

-   Para la categoría "$(152,160]$", en proporción hay más en el grupo que en la proporción global, sin embargo, aunque su $Test.Value$ es significativo, no es **tan alto** respecto a las categorías mencionadas anteriormente. Lo mismo pasa para las categoría "$(139,145]$", sólo que para esta categoría la proporción del grupo es menor respecto a la proporción global, con un $Test.Value$ en valor absoluto mayor a dos pero que respecto a otras categorías no es tan notorio.-

-   Por último, las categorías "$(132,139]$", "$(124,132]$", "$(113,124]$" y "$(0,113]$" están sub-representadas, ya que sus $Test.Values$ son muy grandes en valor absoluto y negativos. El $30.9\%$ de los individuos en esta clase pertenecen a estas categorías, lo cual es **más bajo** que su proporción global del $41.3\%$.

En general, este grupo contiene a personas que tuvieron un desempeño excelente en el examen, indicado por el altísimo valor del $Test.Value$ de los individuos con puntajes en el intervalo "$(180,300]$", los mejores puntajes. Además, también se encuentra una mayor proporción de individuos con puntajes en los intervalos"$(168,180]$" y "$(160,168]$".

```{r}
#| echo: false
kable(repre$cl3)
```

Los departamentos que hacen parte del grupo 3 son:

```{r}
#| echo: false

#str(cluster_df)
kable(cluster_df[cluster_df$Cluster==3,])
```

Los mejores ejes para visualizar este grupo son 1 y 2 de acuerdo con `acs$cor.clus`

```{r}
#| echo: false
plotFactoClass(acs, x=1, y=2, cex.col=0.5,
               roweti="", infaxes="no", cstar=0)
```

#### Grupo 4

En el grupo 4 se tiene:

-   Las categorías "$(0,113]$", "$(113,124]$", "$(124,132]$" y "$(132,139]$" están sobre-representadas, ya que sus $Test.Values$ son muy grandes en valor absoluto y positivos, pues el $50\%$ de los individuos en esta clase pertenecen a estas categorías, lo cual es **más alto** que su proporción global del $41.3\%$.

-   Para las categorías "$(139,145]$" y "$(145,152]$", en proporción hay más en el grupo que en la proporción global, sin embargo, aunque sus $Test.Values$ son significativos, no son **tan altos** respecto a las categorías mencionadas anteriormente. Lo mismo pasa para la categoría "$(152,160]$", sólo que para esta categoría la proporción del grupo es menor respecto a la proporción global, con un $Test.Value$ en valor absoluto mayor a dos pero que respecto a otras categorías no es tan notorio.

-   Por último, las categorías "$(160,168]$", "$(168,180]$" y "$(180,300]$" están sub-representadas, ya que sus $Test.Values$ son muy grandes en valor absoluto y negativos. El $19.2\%$ de los individuos en esta clase pertenecen a estas categorías, lo cual es **más bajo** que su proporción global del $28.9\%$.

En general, este grupo contiene a personas que tuvieron un desempeño regular y malo en el examen, indicado por los altos valores del $Test.Value$ de los individuos con puntajes menores a 152.


```{r}
#| echo: false
kable(repre$cl4)
```

Los departamentos que hacen parte del grupo 4 son:

```{r}
#| echo: false

#str(cluster_df)
kable(cluster_df[cluster_df$Cluster==4,])
```

Los mejores ejes para visualizar este grupo son 1 y 2 de acuerdo con `acs$cor.clus`

```{r}
#| echo: false
plotFactoClass(acs, x=1, y=2, cex.col=0.5,
               roweti="", infaxes="no", cstar=0)
```

#### Grupo 5

En el grupo 5 se tiene:

-   Las categorías "$(0,113]$" y "$(113,124]$" están sobre-representadas, ya que sus $Test.Values$ son muy grandes en valor absoluto y positivos, pues el $64.6\%$ de los individuos en esta clase pertenecen a estas categorías, lo cual es **más alto** que su proporción global del $20.9\%$.

-   Para la categoría "$(124,132]$", en proporción hay más en el grupo que en la proporción global, sin embargo, aunque su $Test.Value$ es significativo, no es **tan altos** respecto a las categorías mencionadas anteriormente. Lo mismo pasa para las categorías "$(132,139]$" y "$(139,145]$", sólo que para esta categoría la proporción del grupo es menor respecto a la proporción global, con un $Test.Value$ en valor absoluto mayor a dos pero que respecto a otras categorías no es tan notorio.

-   Por último, las categorías "$(152,160]$", "$(160,168]$", "$(168,180]$" y "$(180,300]$" están sub-representadas, ya que sus $Test.Values$ son muy grandes en valor absoluto y negativos. El $8.1\%$ de los individuos en esta clase pertenecen a estas categorías, lo cual es **más bajo** que su proporción global del $49.8\%$.

En general, este grupo contiene a personas que tuvieron el peor desempeño del examen, indicado por el altísimo valor del $Test.Value$ de los individuos con puntajes en el intervalo "$(0,113]$", los peores puntajes. Resalta también lo subrepresentados que están los individuos con mejores puntajes en este grupo. Además, también se encuentra una mayor proporción de individuos con puntajes en el intervalo "$(113,124]$".

Les fue muy mal en el examen.

```{r}
#| echo: false
kable(repre$cl5)
```

Los departamentos que hacen parte del grupo 5 son:

```{r}
#| echo: false

#str(cluster_df)
kable(cluster_df[cluster_df$Cluster==5,])
```

Los mejores ejes para visualizar este grupo son 1 y 2 de acuerdo con `acs$cor.clus`

```{r}
#| echo: false
plotFactoClass(acs, x=1, y=2, cex.col=0.5,
               roweti="", infaxes="no", cstar=0)
```
:::

En términos generales, al ordenar los grupos de acuerdo a los puntajes, en orden descendente, quedan:

1.  Grupo 3: Les fue muy bien
2.  Grupo 2: Les fue bien
3.  Grupo 4: No les fue bien ... les fue regular y mal
4.  Grupo 1: Les fue mal
5.  Grupo 5: Les fue muy mal

## Mapa de Colombia

```{r}
#| echo: false
#| warning: false
cluster_df_map <- cluster_df
cluster_df_map <- cluster_df_map[cluster_df_map$Depto!="Desconocido",]
cluster_df_map$CodDep <- c("91","05", "81", "08", "11", "13", "15", "17", "18", "85", "19", "20", "27","23", "25", "94", "95", "41", "44", "47", "50", "52", "54", "86", "63", "66", "88", "68", "70", "73", "76", "97", "99")

library(sf)
#Aquí guardo área y poligonos para que R me logre graficar los departamentos
deptoshp <- st_read("MGN_DPTO_POLITICO.shp",quiet=TRUE)

#Usamos Left join para que haga el cruce por código de departamento y deje todas las columnas
#de deptoshp
mapdeptos <- deptoshp %>%
  left_join(cluster_df_map,by=c("DPTO_CCDGO"="CodDep")) %>%
  select(!(Depto))

#Ahora mundoshp es un mapa de todo el mundo y estamos filtrando los que limitan con locombia
mundoshp <- st_read("admin00.shp",quiet=TRUE)
mundocol <- mundoshp %>%
  filter(CNTRY_NAME %in% c("Peru","Brazil","Venezuela","Ecuador","Panama"))

#Box calcula el rectangulo que envuelve a todo el conjunto de media_pun_tabla mapdeptos (locombia)
#box deja un poquito a la izquierda porque tiene en cuenta a SAN ANDRES
box <- st_bbox(mapdeptos)
#box

mitema <- theme(legend.title=element_text(hjust = 0.5,color = "black"),
                legend.text=element_text(hjust = 0.5),
                plot.title=element_text(face="bold",size=15,vjust=0.5,hjust=0.5,color="black"),
                axis.title.x = element_text(hjust = 0.5, color = "black"),
                axis.title.y = element_text(hjust = 0.5, color = "black"))

# Gráfica
ggplot() +
  geom_sf(data=mundocol) +
  geom_sf(data=mapdeptos,aes(fill=as.factor(Cluster)),col="darkgray",linetype="solid") + #aes fill=xi, el color de relleno dependera de xi
  coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) + #Aqui centramos el mapa en locombia
  labs(x="Longitud",y="Latitud",title="Colombia",fill="Grupos") + #Nombre Ejes
  scale_fill_manual(values = c("blue", "darkgreen", "red", "darkorange", "mediumorchid")) +
  annotate("text", x=c(-74.5,-68,-78,-69,-78.5), y=c(-2.5,0,-1,9,9), colour="black",
           label=c("Perú","Brasil","Ecuador","Venezuela","Panamá")) + #Coloco anotaciones en ciertas coordenadas
  theme(panel.background=element_rect(fill="lightblue")) + mitema
```

Vemos que aunque los grupos no son exactamente como las regiones geográficas, hay ciertas similitudes que vale resaltar. Las regiones periféricas como lo son la orinoquía o la amazonía, y algunos departamentos también costeros como la Guajira o Córdoba tienen puntajes parecidos, siendo estos bajos. Además, muchos departamentos más centrales pertenecientes a la región andina tienen puntajes también parecidos, siendo estos altos. En cuanto al resto tienen un desempeño regular salvando las dos excepciones más importantes, Chocó y Bogotá D.C., en donde se concentran los peores y los mejores puntajes respectivamente.

Aunque no sea una representación uno a uno de las regiones geográficas, se puede apreciar un patrón que vislumbra que las regiones periféricas por lo general tienen peores puntajes que las regiones más centrales.

# Agrupamiento exploratorio

Dado que ya se cumplieron los objetivos del proyecto, se realiza un "agrupamiento exploratorio" de los individuos teniendo en cuenta las variables: Sexo, Departamento de residencia, Estado civil, Valor matrícula universidad, Semestre que cursa, Estrato socioeconómico, Cantidad de horas que trabaja a la semana, la Modalidad de estudio y el Carácter académico de la institución. La razón por la que se seleccionan esas 9 variables para el agrupamiento es porque representan diferentes dimensiones de la vida académica, socioeconómica y personal de los individuos, lo que puede influir de manera significativa en su experiencia y desempeño en la educación.

```{r}
#| echo: false
#| results: hide
#| message: false
#| warning: false
# 4 cifras significativas y sin notación científica:
options(digits = 4, scipen = 999) 

# Carga de datos originales
saberpro <- read_delim("DATA_ICFES_SABERPROPROFESIONAL_2022-2.TXT", delim = "¬", escape_double = FALSE, trim_ws = TRUE)
kable(head(saberpro), digits=2) 

# nuestros datos
data <- saberpro[,-c(1,2,5:9,13:15,17:21,23:26,28:34,49:54,56:62,65,67:70,72:75,77:82,84:86,88:90,92:94,96:98,100:102,104:109)]

# genero
sum(is.na(data$ESTU_GENERO)) # hay 5 NA'S
data$ESTU_GENERO <- ifelse(is.na(data$ESTU_GENERO), "Desconocido", data$ESTU_GENERO)
data$ESTU_GENERO <- as.factor(data$ESTU_GENERO)
table(data$ESTU_GENERO)

# edad
# esta la quitamos
library(stringr)
edad <- str_sub(data$ESTU_FECHANACIMIENTO,7,10)
edad<-as.numeric(edad)
edades<-2023-edad
summary(edades)

# etnia
sum(is.na(data$ESTU_TIENEETNIA)) # 775 na's
data$ESTU_TIENEETNIA <- ifelse(is.na(data$ESTU_TIENEETNIA), "Desconocido", data$ESTU_TIENEETNIA)
data$ESTU_TIENEETNIA <- as.factor(data$ESTU_TIENEETNIA)
table(data$ESTU_TIENEETNIA)

# depto
data$ESTU_DEPTO_RESIDE<-ifelse(data$ESTU_DEPTO_RESIDE %in% c("BARCELONA","BUENOS AIRES","FRANKFURT","HOUSTON","LIMA","MIAMI","NUEVA YORK","PARIS","QUEBEC","ROMA","SACRAMENTO","SANTIAGO DE CHILE","SAO PAULO","SEUL","TRENTON"),"EXTRANJERO",data$ESTU_DEPTO_RESIDE)
sum(is.na(data$ESTU_DEPTO_RESIDE))
length(unique(data$ESTU_DEPTO_RESIDE)) # hay 35 pq son mas los extranjeros y NAs
data$ESTU_DEPTO_RESIDE <- ifelse(is.na(data$ESTU_DEPTO_RESIDE), "Desconocido", data$ESTU_DEPTO_RESIDE)
data$ESTU_DEPTO_RESIDE <- as.factor(data$ESTU_DEPTO_RESIDE)
data <- data %>%
  mutate(ESTU_DEPTO_RESIDE = case_when(
    ESTU_DEPTO_RESIDE == "BOGOTÁ" ~ ESTU_DEPTO_RESIDE,
    ESTU_DEPTO_RESIDE == "Desconocido" ~ "Desconocido",
    TRUE ~ "OTRO"
  ))
data$ESTU_DEPTO_RESIDE <- as.factor(data$ESTU_DEPTO_RESIDE)
table(data$ESTU_DEPTO_RESIDE)


# estado civil
sum(is.na(data$ESTU_ESTADOCIVIL)) # 580 na's
data$ESTU_ESTADOCIVIL <- ifelse(is.na(data$ESTU_ESTADOCIVIL), "Desconocido", ifelse(data$ESTU_ESTADOCIVIL=="Casado","C",ifelse(data$ESTU_ESTADOCIVIL=="Separado y/o Viudo","SyoV",ifelse(data$ESTU_ESTADOCIVIL=="Soltero","S","UL"))))
data$ESTU_ESTADOCIVIL <- as.factor(data$ESTU_ESTADOCIVIL)
table(data$ESTU_ESTADOCIVIL)

# valor matricula
## recodificamos para que quede como factor
sum(is.na(data$ESTU_VALORMATRICULAUNIVERSIDAD)) # 2194 na's
data$ESTU_VALORMATRICULAUNIVERSIDAD <- ifelse(is.na(data$ESTU_VALORMATRICULAUNIVERSIDAD), "Desconocido", ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Menos de 500 mil","m500",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Entre 500 mil y menos de 1 millón","e500m1",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Entre 1 millón y menos de 2.5 millones","e1m2.5",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Entre 2.5 millones y menos de 4 millones","e2.5m4",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Entre 4 millones y menos de 5.5 millones","e4m5.5",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Entre 5.5 millones y menos de 7 millones","e5.5m7",ifelse(data$ESTU_VALORMATRICULAUNIVERSIDAD=="Más de 7 millones","M7","NP"))))))))
data$ESTU_VALORMATRICULAUNIVERSIDAD <- factor(data$ESTU_VALORMATRICULAUNIVERSIDAD, levels = c("m500","e500m1", "e1m2.5", "e2.5m4","e4m5.5","e5.5m7","M7","NP","Desconocido"))
table(data$ESTU_VALORMATRICULAUNIVERSIDAD)

# capacitacion del examen
sum(is.na(data$ESTU_COMOCAPACITOEXAMENSB11)) # 2069 na's
data$ESTU_COMOCAPACITOEXAMENSB11 <- ifelse(is.na(data$ESTU_COMOCAPACITOEXAMENSB11), "Desconocido", ifelse(data$ESTU_COMOCAPACITOEXAMENSB11=="No realizó ninguna prueba de preparación","Ninguna",ifelse(data$ESTU_COMOCAPACITOEXAMENSB11=="Repasó por cuenta propia","CuentaPropia","Curso")))
data$ESTU_COMOCAPACITOEXAMENSB11 <- as.factor(data$ESTU_COMOCAPACITOEXAMENSB11)
table(data$ESTU_COMOCAPACITOEXAMENSB11)


# semestre que cursa
sum(is.na(data$ESTU_SEMESTRECURSA)) # 2194 na's
data$ESTU_SEMESTRECURSA<-ifelse(data$ESTU_SEMESTRECURSA %in% c("01","02","03","04","05","06"),"06m",ifelse(data$ESTU_SEMESTRECURSA=="12 o más","12M",data$ESTU_SEMESTRECURSA))
data$ESTU_SEMESTRECURSA <- ifelse(is.na(data$ESTU_SEMESTRECURSA), "Desconocido", data$ESTU_SEMESTRECURSA)
data$ESTU_SEMESTRECURSA <- as.factor(data$ESTU_SEMESTRECURSA)
table(data$ESTU_SEMESTRECURSA)

# educacion papa
sum(is.na(data$FAMI_EDUCACIONPADRE)) # 4738 na's
data$FAMI_EDUCACIONPADRE <- ifelse(is.na(data$FAMI_EDUCACIONPADRE), "Desconocido", ifelse(data$FAMI_EDUCACIONPADRE=="Educación profesional completa","EPC",ifelse(data$FAMI_EDUCACIONPADRE=="Educación profesional incompleta","EPI",ifelse(data$FAMI_EDUCACIONPADRE=="No Aplica","NAp",ifelse(data$FAMI_EDUCACIONPADRE=="No sabe","NS",ifelse(data$FAMI_EDUCACIONPADRE=="Postgrado","Post",ifelse(data$FAMI_EDUCACIONPADRE=="Primaria completa","PC",ifelse(data$FAMI_EDUCACIONPADRE=="Primaria incompleta","PI",ifelse(data$FAMI_EDUCACIONPADRE=="Secundaria (Bachillerato) completa","BC",ifelse(data$FAMI_EDUCACIONPADRE=="Secundaria (Bachillerato) incompleta","BI",ifelse(data$FAMI_EDUCACIONPADRE=="Técnica o tecnológica completa","TTC",ifelse(data$FAMI_EDUCACIONPADRE=="Técnica o tecnológica incompleta","TTI",data$FAMI_EDUCACIONPADRE))))))))))))
data$FAMI_EDUCACIONPADRE <- as.factor(data$FAMI_EDUCACIONPADRE)
table(data$FAMI_EDUCACIONPADRE)

# educacion mama
sum(is.na(data$FAMI_EDUCACIONMADRE)) # 4886 na's
data$FAMI_EDUCACIONMADRE <- ifelse(is.na(data$FAMI_EDUCACIONMADRE), "Desconocido", ifelse(data$FAMI_EDUCACIONMADRE=="Educación profesional completa","EPC",ifelse(data$FAMI_EDUCACIONMADRE=="Educación profesional incompleta","EPI",ifelse(data$FAMI_EDUCACIONMADRE=="No Aplica","NAp",ifelse(data$FAMI_EDUCACIONMADRE=="No sabe","NS",ifelse(data$FAMI_EDUCACIONMADRE=="Postgrado","Post",ifelse(data$FAMI_EDUCACIONMADRE=="Primaria completa","PC",ifelse(data$FAMI_EDUCACIONMADRE=="Primaria incompleta","PI",ifelse(data$FAMI_EDUCACIONMADRE=="Secundaria (Bachillerato) completa","BC",ifelse(data$FAMI_EDUCACIONMADRE=="Secundaria (Bachillerato) incompleta","BI",ifelse(data$FAMI_EDUCACIONMADRE=="Técnica o tecnológica completa","TTC",ifelse(data$FAMI_EDUCACIONMADRE=="Técnica o tecnológica incompleta","TTI",data$FAMI_EDUCACIONMADRE))))))))))))
data$FAMI_EDUCACIONMADRE <- as.factor(data$FAMI_EDUCACIONMADRE)
table(data$FAMI_EDUCACIONMADRE)

# ocupacion papa
sum(is.na(data$FAMI_OCUPACIONPADRE)) # 2060 na's
data$FAMI_OCUPACIONPADRE <- ifelse(is.na(data$FAMI_OCUPACIONPADRE), "Desconocido", ifelse(data$FAMI_OCUPACIONPADRE=="Empleado con cargo como director o gerente general","EDGG",ifelse(data$FAMI_OCUPACIONPADRE=="Empleado de nivel auxiliar o administrativo","ENAA",ifelse(data$FAMI_OCUPACIONPADRE=="Empleado de nivel directivo","END",ifelse(data$FAMI_OCUPACIONPADRE=="Empleado de nivel técnico o profesional","ENTP",ifelse(data$FAMI_OCUPACIONPADRE=="Empleado obrero u operario","EOO",ifelse(data$FAMI_OCUPACIONPADRE=="Empresario","Emp",ifelse(data$FAMI_OCUPACIONPADRE=="Hogar","H",ifelse(data$FAMI_OCUPACIONPADRE=="Otra actividad u ocupación","OAO", ifelse(data$FAMI_OCUPACIONPADRE=="Pensionado","Pen",ifelse(data$FAMI_OCUPACIONPADRE=="Pequeño empresario","PE",ifelse(data$FAMI_OCUPACIONPADRE=="Profesional independiente","PI","TCP"))))))))))))
data$FAMI_OCUPACIONPADRE <- as.factor(data$FAMI_OCUPACIONPADRE)
table(data$FAMI_OCUPACIONPADRE)

# ocupacion mama
sum(is.na(data$FAMI_OCUPACIONMADRE)) # 2060 na's
data$FAMI_OCUPACIONMADRE <- ifelse(is.na(data$FAMI_OCUPACIONMADRE), "Desconocido", ifelse(data$FAMI_OCUPACIONMADRE=="Empleado con cargo como director o gerente general","EDGG",ifelse(data$FAMI_OCUPACIONMADRE=="Empleado de nivel auxiliar o administrativo","ENAA",ifelse(data$FAMI_OCUPACIONMADRE=="Empleado de nivel directivo","END",ifelse(data$FAMI_OCUPACIONMADRE=="Empleado de nivel técnico o profesional","ENTP",ifelse(data$FAMI_OCUPACIONMADRE=="Empleado obrero u operario","EOO",ifelse(data$FAMI_OCUPACIONMADRE=="Empresario","Emp",ifelse(data$FAMI_OCUPACIONMADRE=="Hogar","H",ifelse(data$FAMI_OCUPACIONMADRE=="Otra actividad u ocupación","OAO", ifelse(data$FAMI_OCUPACIONMADRE=="Pensionado","Pen",ifelse(data$FAMI_OCUPACIONMADRE=="Pequeño empresario","PE",ifelse(data$FAMI_OCUPACIONMADRE=="Profesional Independiente","PI","TCP"))))))))))))
data$FAMI_OCUPACIONMADRE <- as.factor(data$FAMI_OCUPACIONMADRE)
table(data$FAMI_OCUPACIONMADRE)

# estrato
sum(is.na(data$FAMI_ESTRATOVIVIENDA)) # 5531 na's
data$FAMI_ESTRATOVIVIENDA <- ifelse(is.na(data$FAMI_ESTRATOVIVIENDA), "Desconocido", data$FAMI_ESTRATOVIVIENDA)
data$FAMI_ESTRATOVIVIENDA <- as.factor(data$FAMI_ESTRATOVIVIENDA)
table(data$FAMI_ESTRATOVIVIENDA)


# internet
sum(is.na(data$FAMI_TIENEINTERNET)) # 5697 na's
data$FAMI_TIENEINTERNET <- ifelse(is.na(data$FAMI_TIENEINTERNET), "Desconocido", data$FAMI_TIENEINTERNET)
data$FAMI_TIENEINTERNET <- as.factor(data$FAMI_TIENEINTERNET)
table(data$FAMI_TIENEINTERNET)

# computador
sum(is.na(data$FAMI_TIENECOMPUTADOR)) # 6163 na's
data$FAMI_TIENECOMPUTADOR <- ifelse(is.na(data$FAMI_TIENECOMPUTADOR), "Desconocido", data$FAMI_TIENECOMPUTADOR)
data$FAMI_TIENECOMPUTADOR <- as.factor(data$FAMI_TIENECOMPUTADOR)
table(data$FAMI_TIENECOMPUTADOR)

# lavadora
sum(is.na(data$FAMI_TIENELAVADORA)) # 6354 na's
data$FAMI_TIENELAVADORA <- ifelse(is.na(data$FAMI_TIENELAVADORA), "Desconocido", data$FAMI_TIENELAVADORA)
data$FAMI_TIENELAVADORA <- as.factor(data$FAMI_TIENELAVADORA)
table(data$FAMI_TIENELAVADORA)

# microogas
sum(is.na(data$FAMI_TIENEHORNOMICROOGAS)) # 7019 na's
data$FAMI_TIENEHORNOMICROOGAS <- ifelse(is.na(data$FAMI_TIENEHORNOMICROOGAS), "Desconocido", data$FAMI_TIENEHORNOMICROOGAS)
data$FAMI_TIENEHORNOMICROOGAS <- as.factor(data$FAMI_TIENEHORNOMICROOGAS)
table(data$FAMI_TIENEHORNOMICROOGAS)

# tv
sum(is.na(data$FAMI_TIENESERVICIOTV)) # 5801 na's
data$FAMI_TIENESERVICIOTV <- ifelse(is.na(data$FAMI_TIENESERVICIOTV), "Desconocido", data$FAMI_TIENESERVICIOTV)
data$FAMI_TIENESERVICIOTV <- as.factor(data$FAMI_TIENESERVICIOTV)
table(data$FAMI_TIENESERVICIOTV)

# auto
sum(is.na(data$FAMI_TIENEAUTOMOVIL)) # 7187 na's
data$FAMI_TIENEAUTOMOVIL <- ifelse(is.na(data$FAMI_TIENEAUTOMOVIL), "Desconocido", data$FAMI_TIENEAUTOMOVIL)
data$FAMI_TIENEAUTOMOVIL <- as.factor(data$FAMI_TIENEAUTOMOVIL)
table(data$FAMI_TIENEAUTOMOVIL)

# moto
sum(is.na(data$FAMI_TIENEMOTOCICLETA)) # 7525 na's
data$FAMI_TIENEMOTOCICLETA <- ifelse(is.na(data$FAMI_TIENEMOTOCICLETA), "Desconocido", data$FAMI_TIENEMOTOCICLETA)
data$FAMI_TIENEMOTOCICLETA <- as.factor(data$FAMI_TIENEMOTOCICLETA)
table(data$FAMI_TIENEMOTOCICLETA)

# consola
sum(is.na(data$FAMI_TIENECONSOLAVIDEOJUEGOS)) # 7993 na's
data$FAMI_TIENECONSOLAVIDEOJUEGOS <- ifelse(is.na(data$FAMI_TIENECONSOLAVIDEOJUEGOS), "Desconocido", data$FAMI_TIENECONSOLAVIDEOJUEGOS)
data$FAMI_TIENECONSOLAVIDEOJUEGOS <- as.factor(data$FAMI_TIENECONSOLAVIDEOJUEGOS)
table(data$FAMI_TIENECONSOLAVIDEOJUEGOS)

# horas trabaja
sum(is.na(data$ESTU_HORASSEMANATRABAJA)) # 6867 na's
data$ESTU_HORASSEMANATRABAJA <- ifelse(is.na(data$ESTU_HORASSEMANATRABAJA), "Desconocido", data$ESTU_HORASSEMANATRABAJA)
data$ESTU_HORASSEMANATRABAJA <- factor(data$ESTU_HORASSEMANATRABAJA, levels = c("0", "Menos de 10 horas", "Entre 11 y 20 horas", "Entre 21 y 30 horas", "Más de 30 horas", "Desconocido"))
table(data$ESTU_HORASSEMANATRABAJA)

# grupo de referencia
sum(is.na(data$GRUPOREFERENCIA)) # 0 na's
data$GRUPOREFERENCIA<-ifelse(data$GRUPOREFERENCIA=="ADMINISTRACIÓN Y AFINES","AdmYAfin",ifelse(data$GRUPOREFERENCIA=="ARQUITECTURA Y URBANISMO","ArqYUrb",ifelse(data$GRUPOREFERENCIA=="BELLAS ARTES Y DISEÑO","BelArtYDis",ifelse(data$GRUPOREFERENCIA=="CIENCIAS AGROPECUARIAS","CienAgr",ifelse(data$GRUPOREFERENCIA=="CIENCIAS MILITARES Y NAVALES","CienMilYNav",ifelse(data$GRUPOREFERENCIA=="CIENCIAS NATURALES Y EXACTAS","CienNatYExac",ifelse(data$GRUPOREFERENCIA=="CIENCIAS SOCIALES","CienSoc",ifelse(data$GRUPOREFERENCIA=="COMUNICACIÓN, PERIODISMO Y PUBLICIDAD","ComuPerYPub",ifelse(data$GRUPOREFERENCIA=="CONTADURÍA Y AFINES","ContYAfin",ifelse(data$GRUPOREFERENCIA=="DERECHO","Derecho",ifelse(data$GRUPOREFERENCIA=="ECONOMÍA","Economía",ifelse(data$GRUPOREFERENCIA=="ECONOMÍA, ADMINISTRACIÓN, CONTADURÍA Y AFINES - UNIVERSITARIA","EcAdContYAfinU",ifelse(data$GRUPOREFERENCIA=="EDUCACIÓN","Educación",ifelse(data$GRUPOREFERENCIA=="ENFERMERÍA","Enfermeria",ifelse(data$GRUPOREFERENCIA=="GRUPO REFERENCIA NACIONAL","GrupRefNal", ifelse(data$GRUPOREFERENCIA=="GRUPO REFERENCIA NACIONAL UNIVERSITARIO","GrupRefNalU", ifelse(data$GRUPOREFERENCIA=="HUMANIDADES","Hum", ifelse(data$GRUPOREFERENCIA=="INGENIERÍA","Inge", ifelse(data$GRUPOREFERENCIA=="MEDICINA","Med", ifelse(data$GRUPOREFERENCIA=="PSICOLOGÍA","Psic", ifelse(data$GRUPOREFERENCIA=="RECREACIÓN Y DEPORTES","RecYDep", "salud")))))))))))))))))))))
data$GRUPOREFERENCIA<- as.factor(data$GRUPOREFERENCIA)
table(data$GRUPOREFERENCIA)
str(data$GRUPOREFERENCIA) # 22 niveles

# metodo
sum(is.na(data$ESTU_METODO_PRGM)) # 0 na's
data$ESTU_METODO_PRGM <- ifelse(data$ESTU_METODO_PRGM == "DISTANCIA VITUAL", "distVirtual", ifelse(data$ESTU_METODO_PRGM=="DISTANCIA","distancia","presencial"))
data$ESTU_METODO_PRGM<- as.factor(data$ESTU_METODO_PRGM)
table(data$ESTU_METODO_PRGM)

# caracter academico institucion
sum(is.na(data$INST_CARACTER_ACADEMICO)) # 0 na's
data$INST_CARACTER_ACADEMICO<-ifelse(data$INST_CARACTER_ACADEMICO=="INSTITUCIÓN TECNOLÓGICA","InstTec",ifelse(data$INST_CARACTER_ACADEMICO=="INSTITUCIÓN UNIVERSITARIA","InstUni", ifelse(data$INST_CARACTER_ACADEMICO=="TÉCNICA PROFESIONAL","TecProf", "Universidad")))
data$INST_CARACTER_ACADEMICO<- as.factor(data$INST_CARACTER_ACADEMICO)
table(data$INST_CARACTER_ACADEMICO)

names(data)[29:33]<-c("cuanti","lec","ciu","ing","esc")
```


## Procedimiento de agrupación

### Paso 1

Realización del ACM entre las variables `ESTU_GENERO`, `ESTU_DEPTO_RESIDE`, `ESTU_ESTADOCIVIL`, `ESTU_VALORMATRICULAUNIVERSIDAD`, `ESTU_SEMESTRECURSA`, `FAMI_ESTRATOVIVIENDA`, `ESTU_HORASSEMANATRABAJA`, `ESTU_METODO_PRGM` y `INST_CARACTER_ACADEMICO`.

::: callout-note
Para que este ACS no se viera afectado por la poca frecuencia que tiene la categoría "Desconocido" en la mayoría de las variables, se incluyeron los individuos pertenecientes a esta categoría dentro de la categoría que tuviese mayor frecuencia, tal como se hizo en los ACM de la sección de ACM sin "Desconocidos" @sec-sinDesconocido .
:::

```{r}
#| echo: false
#| message: false
Y <- data[,c(1,4,6,7,9,14,23,27,28)]
Ys <- Y
#Ys <- cbind(data$PUNT_GLOBAL, data$FAMI_EDUCACIONMADRE, data$FAMI_EDUCACIONPADRE, data$FAMI_OCUPACIONMADRE, data$FAMI_OCUPACIONPADRE ,Y)

# Para no tener problema con los desconocidos, los vamos a incluir en la categoria que tenga más individuos

# Sexo
Ys$ESTU_GENERO <- as.character(Ys$ESTU_GENERO)
Ys$ESTU_GENERO <- ifelse(Ys$ESTU_GENERO == "Desconocido", "F", Ys$ESTU_GENERO)
Ys$ESTU_GENERO <- factor(Ys$ESTU_GENERO)

# Depto
#table(Ys$ESTU_DEPTO_RESIDE)
Ys$ESTU_DEPTO_RESIDE <- as.character(Ys$ESTU_DEPTO_RESIDE)
Ys$ESTU_DEPTO_RESIDE <- ifelse(Ys$ESTU_DEPTO_RESIDE == "Desconocido", "OTRO", Ys$ESTU_DEPTO_RESIDE)
Ys$ESTU_DEPTO_RESIDE <- factor(Ys$ESTU_DEPTO_RESIDE)
#table(Ys$ESTU_DEPTO_RESIDE)

# Estado civil
#table(Ys$ESTU_ESTADOCIVIL)
Ys$ESTU_ESTADOCIVIL <- as.character(Ys$ESTU_ESTADOCIVIL)
Ys$ESTU_ESTADOCIVIL <- ifelse(Ys$ESTU_ESTADOCIVIL == "Desconocido", "S", Ys$ESTU_ESTADOCIVIL)
Ys$ESTU_ESTADOCIVIL <- factor(Ys$ESTU_ESTADOCIVIL)
#table(Ys$ESTU_ESTADOCIVIL)

# Valor matricula
#table(Ys$ESTU_VALORMATRICULAUNIVERSIDAD)
Ys$ESTU_VALORMATRICULAUNIVERSIDAD <- as.character(Ys$ESTU_VALORMATRICULAUNIVERSIDAD)
Ys$ESTU_VALORMATRICULAUNIVERSIDAD <- ifelse(Ys$ESTU_VALORMATRICULAUNIVERSIDAD == "Desconocido", "e1m2.5", Ys$ESTU_VALORMATRICULAUNIVERSIDAD)
Ys$ESTU_VALORMATRICULAUNIVERSIDAD <- factor(Ys$ESTU_VALORMATRICULAUNIVERSIDAD)
#table(Ys$ESTU_VALORMATRICULAUNIVERSIDAD)

# Semestre que cursa
#table(Ys$ESTU_SEMESTRECURSA)
Ys$ESTU_SEMESTRECURSA <- as.character(Ys$ESTU_SEMESTRECURSA)
Ys$ESTU_SEMESTRECURSA <- ifelse(Ys$ESTU_SEMESTRECURSA == "Desconocido", "09", Ys$ESTU_SEMESTRECURSA)
Ys$ESTU_SEMESTRECURSA <- factor(Ys$ESTU_SEMESTRECURSA)
#table(Ys$ESTU_SEMESTRECURSA)

# Estrato
#table(Ys$FAMI_ESTRATOVIVIENDA)
Ys$FAMI_ESTRATOVIVIENDA <- as.character(Ys$FAMI_ESTRATOVIVIENDA)
Ys$FAMI_ESTRATOVIVIENDA <- ifelse(Ys$FAMI_ESTRATOVIVIENDA == "Desconocido", "Estrato 2", Ys$FAMI_ESTRATOVIVIENDA)
Ys$FAMI_ESTRATOVIVIENDA <- factor(Ys$FAMI_ESTRATOVIVIENDA)
#table(Ys$FAMI_ESTRATOVIVIENDA)

# Horas trabaja
#table(Ys$ESTU_HORASSEMANATRABAJA)
Ys$ESTU_HORASSEMANATRABAJA <- as.character(Ys$ESTU_HORASSEMANATRABAJA)
Ys$ESTU_HORASSEMANATRABAJA <- ifelse(Ys$ESTU_HORASSEMANATRABAJA == "Desconocido", "Más de 30 horas", Ys$ESTU_HORASSEMANATRABAJA)
Ys$ESTU_HORASSEMANATRABAJA <- factor(Ys$ESTU_HORASSEMANATRABAJA)
#table(Ys$ESTU_HORASSEMANATRABAJA)

# Modalidad
#table(Ys$ESTU_METODO_PRGM) # no tiene desconocido

# Caracter académico
#table(Ys$INST_CARACTER_ACADEMICO) # no tiene desconocido

#MCA con ventilación de aquellas categorias menores al 6%
#res.mca <- MCA(Ys, graph=FALSE, quali.sup = c(2), quanti.sup = 1)
#acm_ventil<-MCA(Ys,graph = FALSE, quali.sup = c(2,3,4,5), quanti.sup = 1, level.ventil = 0.06)

# ACM
acm <- MCA(Ys, graph=FALSE)
fviz_screeplot(acm, addlabels = TRUE, ylim = c(0, 20))
```

### Paso 2

Conservaremos 10 ejes para no perder información para formar los grupos.

### Paso 3

Fue necesario realizar un K-means de pre-agrupamiento ya que se tienen 127342 individuos. Con el k-means se obtuvieron 5000 grupos de individuos que pasarán ahora a un agrupamiento jerárquico.

```{r}
#| echo: false
Y<-acm$ind$coord[,1:5]

set.seed(627) #Fijamos la semilla
pregroup<- kmeans(Y, centers = 5000)  #Agrupamos los datos en 5000 grupos
```


### Paso 4

Se realiza un agrupamiento jerárquico utilizando el método de Ward que busca una inercia mínima dentro de los grupos y mayor inercia entre grupos (en este caso, grupo de grupos).

El dendograma de la agrupación jerárquica es:

```{r}
#| echo: false
hclCafe <- ward.cluster(dista=dist(pregroup$centers), h.clust=1) # función de FactoClass
plot(hclCafe, las=1, col="darkblue", main="", sub="", xlab="")
abline(h=seq(0, 7, 0.5), col="gray90", lty=3)
```

Gracias al dendograma, los posibles candidatos para número de grupos son: 7, 5, 4, 3 y 2.

### Paso 5

Con la agrupación jerárquica se obtienen los valores inciales para el k-means. Se probaron con todas las distintas opciones de número de grupos, al realizar 4 grupos se ve una "clara" diferencia entre los grupos al menos en una de las 9 variables. Al intentar con las otras opciones ningún grupo se diferenciaba mucho del otro.


```{r}
#| echo: false
grupos_jerarquicos <- cutree(hclCafe, k=4)
```

### Paso 6

Caracterización y visualización de los grupos:

```{r}
#| echo: false
#| warning: false
set.seed(627) #Fijamos semilla 

centros_de_gravedad <- aggregate(pregroup$centers, by = list(grupos_jerarquicos), FUN = mean) #Calculamos los centros de gravedad obtenidos para los 5000 grupos


kmeans_consolidacion <- kmeans(pregroup$centers, centers = centros_de_gravedad[, -1]) #Iniciamos kmeans con los centros de gravedad calculados

ordenados <- order(rowSums(kmeans_consolidacion$centers))

# Crear una nueva asignación de grupos reordenada
consolidacion <- match(kmeans_consolidacion$cluster, ordenados)

Grupos<-consolidacion[pregroup$cluster] #Obtenemos los grupos finales

Y<-as.data.frame(Y)
Y[["GrupoFinal"]]<-as.factor(Grupos) # tiene las coordenadas de cada individuo y el grupo al que fue asignado
Ys<-cbind(Ys,Y["GrupoFinal"]) 
valores_test<-cluster.carac(Ys[,1:9], Ys$GrupoFinal)


library(kableExtra)

grups <- as.data.frame(table(Ys$GrupoFinal)/nrow(Ys)*100)
colnames(grups) <- c("Grupo", "Porcentaje")
#kable(grups)
```



::: panel-tabset

#### Grupo 1

Dado que los valores test son muy muy grandes ($\infty$), en este grupo se encuentran personas que viven en Bogotá, son solteras, pagan entre 4 millones y hasta más de 7 millones de matrícula, pertenecen a estrato 3, 4, 5 y 6, no trabajan, y estudian en una Universidad de forma presencial.

Si bien los valores test no son muy muy grandes, sí son altos, por lo que en este grupo también se caracteriza por individuos que cursan el semestre número 7, 11 o más de 12 y de sexo femenino.

```{r}
#| echo: false
kable(valores_test[["1"]]) %>% kable_styling("striped", full_width = T) %>% 
 scroll_box(height = "500px")
```

#### Grupo 2

Dado que los valores test son muy muy grandes ($\infty$), en este segundo grupo se encuentran personas que pagan entre 2.5 y 4 millones de matrícula, cursan el 10 semestre, trabajan más de 30 horas a la semana, estudian de forma presencial en un Instituto Técnico o en un Técnico Profesional.

Si bien los valores test no son muy muy grandes, sí son altos, por lo que en este grupo también se caracteriza por individuos de sexo masculino, de estrato 2, viven en unión libre o son casados, estudian en un instituto universitario y no viven en Bogotá.

```{r}
#| echo: false
kable(valores_test[["2"]]) %>% kable_styling("striped", full_width = T) %>% 
 scroll_box(height = "500px")
```


#### Grupo 3

Dado que los valores test son muy muy grandes ($\infty$), en este tercer grupo se encuentran personas que NO viven en Bogotá, no pagan o pagan entre 500 mil y 1 millón de matrícula, cursan el semestre 9, pertenecen al estrato 1, estudia en una universidad a distancia.

Si bien los valores test no son muy muy grandes, sí son altos, por lo que en este grupo también se caracteriza por individuos que trabajan menos de 10 horas a la semana o máximo 30 horas a la semana, son de estrato 2, viven en unión libre y son de sexo masculino.

```{r}
#| echo: false
kable(valores_test[["3"]]) %>% kable_styling("striped", full_width = T) %>% 
 scroll_box(height = "500px")
```


#### Grupo 4

Dado que los valores test son muy muy grandes ($\infty$), en este cuarto grupo se encuentran personas casadas o en unión libre, pagan entre 1 y 2.5 millones de matrícula, trabajan más de 30 horas a la semana y estudian en un Instituto Universitario a distancia o virtual.

Si bien los valores test no son muy muy grandes, sí son altos, por lo que en este grupo también se caracteriza por individuos de sexo femenino, cursan el semestre 7, 6 o menos, son de estrato 2 o 3, son separados y/o viudos, y viven en Bogotá.

```{r}
#| echo: false
kable(valores_test[["4"]]) %>% kable_styling("striped", full_width = T) %>% 
 scroll_box(height = "500px")
```


:::

La segmentación de los individuos en los cuatro grupos muestra una clara diferenciación socioeconómica, académica y geográfica, lo que permite identificar perfiles distintos en función de sus condiciones de vida y estudios.

-   **Grupo 1:** Agrupa principalmente a estudiantes de alto estrato socioeconómico (3-6), residentes en Bogotá, que estudian de forma presencial en universidades, no trabajan, y pagan matrículas elevadas. Este grupo también se caracteriza por tener mayor presencia de mujeres cursando semestres avanzados. Estos resultados sugieren que son estudiantes con menos cargas laborales y con acceso a universidades más costosas, lo que podría estar asociado con una mayor disponibilidad de recursos familiares y económicos.

-   **Grupo 2:** Está compuesto por estudiantes que pagan matrículas intermedias, estudian en Institutos Técnicos o Técnicos Profesionales, trabajan más de 30 horas a la semana y no residen en Bogotá. Se destacan los hombres casados o en unión libre de estrato bajo (2) que están cursando el último semestre de sus estudios. Este grupo parece estar conformado por estudiantes que combinan estudio y trabajo intensivamente, posiblemente debido a la necesidad de generar ingresos mientras continúan sus estudios en instituciones más accesibles económicamente.

-   **Grupo 3:** Incluye a estudiantes de bajo estrato (1-2), que no pagan o pagan muy poco por su matrícula, y cursan estudios a distancia, lo cual puede estar relacionado con la necesidad de trabajar mientras estudian o con la falta de acceso a universidades presenciales en sus lugares de residencia. Este grupo está conformado mayoritariamente por hombres de fuera de Bogotá, que trabajan menos de 30 horas a la semana y viven en unión libre. Se trata de estudiantes con menos recursos que eligen modalidades más flexibles para equilibrar sus responsabilidades laborales y académicas.

-   **Grupo 4:** Agrupa a personas casadas o en unión libre que estudian de forma virtual en Institutos Universitarios, trabajan más de 30 horas a la semana y pagan matrículas moderadas. Son mayormente mujeres de estratos 2 y 3 que viven en Bogotá y están cursando semestres intermedios o bajos. Este grupo parece estar conformado por estudiantes con responsabilidades familiares y laborales que eligen modalidades de estudio a distancia para compatibilizar sus distintas actividades.

En general, cada grupo refleja las diferentes formas en que las circunstancias personales y socioeconómicas impactan la experiencia educativa. Los grupos con estudiantes que no trabajan y pagan matrículas elevadas (Grupo 1) contrastan claramente con aquellos que estudian y trabajan simultáneamente para sostenerse (Grupos 2, 3 y 4). Además, el lugar de residencia y la modalidad de estudio juegan un rol clave en la diferenciación de los grupos, con los estudiantes fuera de Bogotá y en modalidades a distancia mostrando perfiles económicos y académicos menos privilegiados. Estos resultados podrían utilizarse para diseñar políticas de apoyo dirigidas a estudiantes con mayores cargas laborales o de menores ingresos.

```{r}
#| echo: false
fviz_mca_ind(acm,label = "none",
             axes=c(1,2),
             habillage = Y$GrupoFinal,
             #col.ind= Y$GrupoFinal,
             palette = "lancet",  addEllipses = TRUE,
             ellipse.type = "convex",
             repel = TRUE) 
```

# Conclusiones

Realizado todo el análisis, Análisis de Componentes Principales, Análisis de Correspondencias Múltiples y Agrupamiento, podemos concluir que se lograron los objetivos. 

Primero que nada, se analizó y comparó los puntajes en los distintos componentes diferenciando entre el carácter académico de las instituciones, grupos de referencia, costos de matrícula, estrato, edad y género. Todo esto se logró en el Análisis de Componentes Principales. Además de esto, en el Análisis de Componentes Principales se analizó la posible relación entre variables con información socioeconómica, variables con información académica y variables con información personal y los puntajes de las pruebas, con hallazgos como que el estrato parece estar estrechamente relacionado, así como la educación de los padres, cargos de los padres, el carácter académico de la institución, las horas que trabaja a la semana el alumno, el costo de la matrícula, entre otras variables.

El Análisis de Correspondencias Múltiples reafirmó estos hallazgos, y aunque surgieron dificultades en el tratamiento de los datos debido a la cantidad pequeña pero importante de datos faltantes en muchas variables, las conclusiones a las que se llegaron no se diferenciaban de las conclusiones del Análisis de Componentes Principales pues la inercia de estas categorías por lo general se encontraba compacta en un solo eje. Por esto mismo, a grandes rasgos, se podría hacer un índice utilizando tanto un Análisis de Componentes Principales como un Análisis de Correspondencias Múltiples, pues ambos representarían bien a los individuos además de explicar gran parte de la inercia utilizando un solo eje.

Por último, para cumplir el tercer objetivo con el Agrupamiento se tuvo que realizar antes un Análisis de Correspondencias Simples que relacionaba la información del departamento con distintos intervalos del puntaje global obtenido en las pruebas. Teniendo la información relacionada de esta manera, el Agrupamiento mostró que aunque no hay una representación uno a uno respecto a las regiones geográficas, si hay ciertos indicios de que hay regiones que obtienen puntajes parecidos entre sus departamentos. No sólo esto, sino que además mostró que los individuos que hacen parte de los departamentos de la periferia del país tienden a tener puntajes tanto parecidos como peores del promedio, mientras que los individuos que hacen parte de los departamentos centrales tienden a tener mejores puntajes que el promedio. Por lo que la exploración descriptiva parece sugerir que sí hay una relación espacial entre los puntajes, sin embargo, no como se esperaba.
